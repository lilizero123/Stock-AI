var apiHost = "//api.fund.eastmoney.com"; try { if (location.origin.indexOf("fundtest.eastmoney.com") > -1) { apiHost = "//fundtest.eastmoney.com/dataapi" } } catch (e) { } function isLtIE9() { try { var ie = navigator.userAgent.match(/MSIE\s([\d.]+)/) || navigator.userAgent.match(/Trident\/.+?rv:(([\d.]+))/); return ie && ie[1] <= 8 } catch (e) { } return false } function getChartTips() { return "<div style='border: 1px solid #FFE780;background-color: #FFFDEB;padding:10px;'>您当前使用的浏览器版本过低，图表功能无法正常使用。为了获得最佳体验，建议您升级浏览器或使用其他较新的浏览器。</div>" } function initLtIE9Tip(objId) { try { if (isLtIE9()) { var tips = getChartTips(); jQuery("#" + objId).html(tips) } } catch (e) { } } var _loadingHtml = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; function switchTabEvent(showObj, tag, index, classname, evType, callback) { if (evType == "" || typeof (evType) == "undefined") { evType = "mouseover" } else { evType = "click" } var subs = $(showObj).getElementsByTagName(tag); var evtChg = function (e) { var eObj = $E(e); var atTab = 0; for (var i = 0; i < subs.length; i++) { subs[i].className = ""; if (subs[i] == eObj) { subs[i].className = classname; atTab = i } else { subs[i].className = "" } } if (callback) { var pObj = callback()._param; pObj.pindex = 1; pObj.type = atTab; callback()._init(pObj) } }; for (var i = 0; i < subs.length; i++) { subs[i].className = ""; if (i == index) { subs[i].className = classname } else { subs[i].className = "" } } if (callback) { var pObj = callback()._param; pObj.pindex = 1; pObj.type = index; callback()._init(pObj) } $aE($(showObj), evType, evtChg, false) } function switchLinkEvent(showObj, tag, index, classname, callback) { var subs = $(showObj).getElementsByTagName(tag); for (var i = 0; i < subs.length; i++) { subs[i].className = ""; if (i == index) { subs[i].className = classname } else { subs[i].className = "" } } if (callback) { var pObj = callback()._param; pObj.pindex = 1; pObj.type = index; callback()._init(pObj) } } function focusCalendar(char1, channel) { if (channel == "gg") { switch (char1) { case "s": document.getElementById("jjggSDate").focus(); break; case "e": document.getElementById("jjggEDate").focus(); break } } if (channel == "jz") { switch (char1) { case "s": document.getElementById("lsjzSDate").focus(); break; case "e": document.getElementById("lsjzEDate").focus(); break } } } function makePageBar(allRecord, allPage, curPage) { if (allRecord > 0) { if (allPage > 0) { var pagebar = ""; if (curPage == 1) { pagebar = '<label class="end" value="1">上一页</label>' } else { pagebar = '<label value="' + (parseInt(curPage) - 1) + '">上一页</label>' } if (allPage > 5) { if (allPage - curPage < 5) { for (_pi = allPage - 4; _pi <= allPage; _pi++) { if (curPage == _pi) { pagebar += '<label value="' + _pi + '" class="cur">' + _pi + "</label>" } else { pagebar += '<label value="' + _pi + '">' + _pi + "</label>" } } } else { if (curPage > 2) { for (_pi = curPage - 2; _pi <= parseInt(curPage) + 2; _pi++) { if (curPage == _pi) { pagebar += '<label value="' + _pi + '" class="cur">' + _pi + "</label>" } else { pagebar += '<label value="' + _pi + '">' + _pi + "</label>" } } } else { for (_pi = 1; _pi <= 5; _pi++) { if (curPage == _pi) { pagebar += '<label value="' + _pi + '" class="cur">' + _pi + "</label>" } else { pagebar += '<label value="' + _pi + '">' + _pi + "</label>" } } } pagebar += "<span>...</span>"; pagebar += '<label value="' + allPage + '">' + allPage + "</label>" } } else { for (_pi = 1; _pi <= allPage; _pi++) { if (curPage == _pi) { pagebar += '<label value="' + _pi + '" class="cur">' + _pi + "</label>" } else { pagebar += '<label value="' + _pi + '">' + _pi + "</label>" } } } if (curPage == allPage) { pagebar += '<label value="' + curPage + '" class="end">下一页</label>' } else { pagebar += '<label value="' + (parseInt(curPage) + 1) + '">下一页</label>' } pagebar += "<span>转到</span>"; pagebar += '<input type="text" class="pnum" />'; pagebar += "<span>页</span>"; pagebar += '<input type="button" class="pgo" />'; return '<div class="pagebtns">' + pagebar + '</div><div class="space0"></div>' } else { return '<div class="pagebtns"><span style="color:red;">符合查找条件记录为空!</span></div><div class="space0"></div>' } } else { return '<div class="pagebtns"></div><div class="space0"></div>' } } function makePageBarForYear(Years, curYear) { if (Years.constructor === Array) { var allPage = Years.length; if (allPage > 0) { var curPage = -1; for (var i = 0; i < allPage; i++) { if (Years[i] == curYear) { curPage = i + 1; break } } var pagebar = ""; if (allPage > 10) { if (allPage - curPage < 9) { pagebar += '<label value="' + Years[0] + '">' + Years[0] + "年</label>"; pagebar += "<span>...</span>"; for (_pi = allPage - 8; _pi <= allPage; _pi++) { if (curPage == _pi) { pagebar += '<label value="' + Years[_pi - 1] + '" class="cur">' + Years[_pi - 1] + "年</label>" } else { pagebar += '<label value="' + Years[_pi - 1] + '">' + Years[_pi - 1] + "年</label>" } } } else { if (curPage > 6) { pagebar += '<label value="' + Years[0] + '">' + Years[0] + "年</label>"; pagebar += "<span>...</span>"; for (_pi = curPage - 3; _pi <= parseInt(curPage) + 3; _pi++) { if (curPage == _pi) { pagebar += '<label value="' + Years[_pi - 1] + '" class="cur">' + Years[_pi - 1] + "年</label>" } else { pagebar += '<label value="' + Years[_pi - 1] + '">' + Years[_pi - 1] + "年</label>" } } } else { for (_pi = 1; _pi <= 9; _pi++) { if (curPage == _pi) { pagebar += '<label value="' + Years[_pi - 1] + '" class="cur">' + Years[_pi - 1] + "年</label>" } else { pagebar += '<label value="' + Years[_pi - 1] + '">' + Years[_pi - 1] + "年</label>" } } } pagebar += "<span>...</span>"; pagebar += '<label value="' + Years[allPage - 1] + '">' + Years[allPage - 1] + "年</label>" } } else { for (_pi = 1; _pi <= allPage; _pi++) { if (curPage == _pi) { pagebar += '<label value="' + Years[_pi - 1] + '" class="cur">' + Years[_pi - 1] + "年</label>" } else { pagebar += '<label value="' + Years[_pi - 1] + '">' + Years[_pi - 1] + "年</label>" } } } return '<div class="pagebtns">' + pagebar + "</div>" } else { return "" } } else { return '<div class="pagebtns">ok</div>' } } function CalPagePosition(element) { if ($(element || "pagebar").firstChild) { var strwidth = $(element || "pagebar").firstChild.offsetWidth; $(element || "pagebar").firstChild.style.left = (790 - strwidth) / 2 + "px" } } function CalPagePositionNew(element) { var obj = document.getElementById(element || "pagebar"); if (obj.firstChild) { var strwidth = obj.firstChild.offsetWidth; obj.firstChild.style.left = (790 - strwidth) / 2 + "px" } } function ChkSelectItem(selObj, selectValue) { var options = $(selObj).getElementsByTagName("option"); for (var i = 0; i < options.length; i++) { if (options[i].getAttribute("value") == selectValue) { try { options[i].selected = true } catch (e) { } } else { continue } } } function ChkSelectLiItem(selectValue) { var options = $("fundul").getElementsByTagName("li"); for (var i = 0; i < options.length; i++) { if (options[i].getAttribute("fundcode") == selectValue) { $("fcodelb").innerHTML = options[i].innerHTML } else { continue } } } function EventForPageBtn(pObj, callback, element) { var strcode = pObj.code; var pageindex = pObj.pindex; var pers = pObj.pernum; var pages = pObj.pages; var pagebar = element || "pagebar"; var btns = $(pagebar).getElementsByTagName("label"); var puts = $(pagebar).getElementsByTagName("input"); var txtput = null; for (var i = 0; i < btns.length; i++) { btns[i].onclick = function () { if (this.className.indexOf("end") > -1 || this.className.indexOf("cur") > -1) { return false } else { var pageindex = this.getAttribute("value"); pObj.pindex = pageindex; callback(pObj) } } } for (var i = 0; i < puts.length; i++) { if (puts[i].getAttribute("type") == "text") { txtput = puts[i]; puts[i].onkeyup = function (e) { var e = e || window.event; if (e.keyCode == 13) { var tonum = txtput.value; if (tonum != "") { if (!isNaN(tonum)) { if (parseInt(tonum) < 1 || parseInt(tonum) > pages) { alert("请输入有效页码!"); txtput.value = ""; return false } else { pObj.pindex = tonum; callback(pObj) } } else { alert("请输入整数型页码!"); txtput.value = ""; return false } } else { alert("请输入页码!") } } } } if (puts[i].getAttribute("type") == "button") { puts[i].onclick = function () { if (txtput != null) { tonum = txtput.value; if (tonum != "") { if (!isNaN(tonum)) { if (parseInt(tonum) < 1 || parseInt(tonum) > pages) { alert("请输入有效页码!"); txtput.value = ""; return false } else { pObj.pindex = tonum; callback(pObj) } } else { txtput.value = ""; return false } } else { alert("请输入页码!") } } else { return false } } } } } function EventForYearBtn(pObj, callback) { var strcode = pObj.code; var arryear = pObj.years; var btns = $("pagebar").getElementsByTagName("label"); for (var i = 0; i < btns.length; i++) { btns[i].onclick = function () { if (this.className.indexOf("end") > -1 || this.className.indexOf("cur") > -1) { return false } else { var curyear = this.getAttribute("value"); pObj.year = curyear; if (pObj.month) { pObj.month = "" } callback(pObj) } } } } function LoadLsjz(pObj) { $("jztable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var pageindex = pObj.pindex; var pers = pObj.pernum; var sdate = pObj.startDate; var edate = pObj.endDate; var request = apiHost + "/f10/lsjz?callback=?&fundCode=" + strcode + "&pageIndex=" + pageindex + "&pageSize=" + pers + "&startDate=" + sdate + "&endDate=" + edate; jQuery.getJSON(request, function (data) { if (data && data.ErrCode == 0 && data.Data && data.Data.LSJZList && data.Data.LSJZList.length > 0) { var html = template("lsjzTable", data); if (html) { jQuery("#jztable").html(html); var pagerHtml = makePageBar(data.TotalCount, Math.ceil(data.TotalCount / data.PageSize), data.PageIndex); jQuery("#pagebar").html(pagerHtml); CalPagePosition(); pObj.pages = Math.ceil(data.TotalCount / data.PageSize); if (data.Data.isNewType && data.PageIndex == pObj.pages) { jQuery("#historyText").css("display", "block") } else { jQuery("#historyText").css("display", "none") } EventForPageBtn(pObj, LoadLsjz); jQuery("#jjjzTip").ttjjTooltip(); initAbnormalTip("abnormal_tip") } } else { jQuery("#jztable").html("<label class='tbnull'>暂无数据!</label>"); jQuery("#pagebar").html("") } }) } function LoadLssy(pObj) { $("jztable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var pageindex = pObj.pindex; var pers = pObj.pernum; var sdate = pObj.startDate; var edate = pObj.endDate; var request = apiHost + "/f10/lssy?callback=?&fundCode=" + strcode + "&pageIndex=" + pageindex + "&pageSize=" + pers + "&startDate=" + sdate + "&endDate=" + edate; jQuery.getJSON(request, function (data) { if (data && data.ErrCode == 0 && data.Data && data.Data.LSJZList && data.Data.LSJZList.length > 0) { var html = template("lsyzTable", data); if (html) { jQuery("#jztable").html(html); var pagerHtml = makePageBar(data.TotalCount, Math.ceil(data.TotalCount / data.PageSize), data.PageIndex); jQuery("#pagebar").html(pagerHtml); CalPagePosition(); pObj.pages = Math.ceil(data.TotalCount / data.PageSize); EventForPageBtn(pObj, LoadLssy); jQuery("#jjjzTip").ttjjTooltip() } } else { jQuery("#jztable").html("<label class='tbnull'>暂无数据!</label>") } }) } function initAbnormalTip(id) { var obj = jQuery("#" + id); window.tipsBubble = null; jQuery(obj).on("mouseover", function () { clearInterval(tipsBubble); jQuery(".tipsBubble").hide(); jQuery(this).find(".tipsBubble").show() }); jQuery(obj).on("mouseout", function () { var _this = jQuery(this); tipsBubble = setTimeout(function () { _this.find(".tipsBubble").hide() }, 300) }) } function SearchField() { var start = $("lsjzSDate").value; var end = $("lsjzEDate").value; params.pindex = 1; params.startDate = start; params.endDate = end; LoadLsjz(params) } function SearchSYField() { var start = $("lsjzSDate").value; var end = $("lsjzEDate").value; params.pindex = 1; params.startDate = start; params.endDate = end; LoadLssy(params) } function LoadJJGG(pObj) { jQuery("#ggtable").html("<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"); var strcode = pObj.code; var pageindex = pObj.pindex; var pers = pObj.pernum; var stype = pObj.type; var request = apiHost + "/f10/JJGG?callback=?&fundcode=" + strcode + "&pageIndex=" + pageindex + "&pageSize=" + pers + "&type=" + stype; jQuery.getJSON(request, function (data) { if (data && data.ErrCode == 0) { var html = template("jjggtmp", data); jQuery("#ggtable").html(html); jQuery("#pagebar").html(makePageBar(data.TotalCount, Math.ceil(data.TotalCount / data.PageSize), data.PageIndex)); CalPagePosition(); pObj.pages = Math.ceil(data.TotalCount / data.PageSize); EventForPageBtn(pObj, LoadJJGG) } else { jQuery("#ggtable").html("<label class='tbnull'>暂无数据</label>") } }) } function LoadFHGG(pObj) { jQuery("#fhggtable").html("<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"); var strcode = pObj.code; var strtop = pObj.topnum; var request = apiHost + "/f10/FHGG?callback=?&fundcode=" + strcode + "&pageSize=" + strtop + "&pageIndex=1"; jQuery.getJSON(request, function (data) { if (data && data.ErrCode == 0) { var html = template("jjfhgg", data); jQuery("#fhggtable").html(html) } else { jQuery("#fhggtable").html("<label class='tbnull'>暂无基金分红公告!</label>") } }) } function LoadMore(obj, month, callback) { if (params) { if (params.month) { if (params.month.toString().indexOf(month) == -1) { params.month += "," + month } else { if (params.month.toString().indexOf(month) == 0) { params.month = params.month.toString().replace(month + ",", ""); params.month = params.month.toString().replace(month, "") } else { params.month = params.month.toString().replace("," + month, "") } } } else { params.month = month } if (callback) { callback(params) } } } function LoadIndustryConfig(pObj) { var strcode = pObj.code; var syear = pObj.year; jQuery("#hypztable").html("<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"); var request = apiHost + "/f10/HYPZ/?fundCode=" + strcode + "&year=" + syear + "&callback=?"; jQuery.getJSON(request, function (ret) { if (ret && ret.ErrCode == 0) { var html = template("temphypz", ret); if (ret.Data && ret.Data.QuarterInfos && ret.Data.QuarterInfos.length > 0) { jQuery("#hypng").attr("src", "//j6.dfcfw.com/charts/HypzArchivesNew/" + strcode + ".png") } else { jQuery("#hypng").hide() } jQuery("#hypztable").html(html); jQuery("#pagebar").html(makePageBarForYear(ret.Data.ListYears, ret.Data.Curyear)); CalPagePositionNew(); pObj.years = ret.Data.ListYears } else { jQuery("#hypng").attr("src", "//j6.dfcfw.com/charts/999999_Archives.png"); jQuery("#hypztable").html(""); jQuery("#pagebar").html("") } LoadTimeSelect("hypz", pObj, LoadIndustryConfig); ChkSelectItem("hypz", syear); EventForYearBtn(pObj, LoadIndustryConfig) }) } function LoadFundSelect(selObj, module, selectValue) { var select = $(selObj); if (r && r.length > 0) { var option = $C("option"); option.value = "000001"; option.innerHTML = "选择基金"; select.appendChild(option); for (var i = 0; i < r.length; i++) { option = $C("option"); var item = r[i].toString().split(","); option.value = item[0]; option.innerHTML = item[0] + " - " + item[2]; if (selectValue && item[0] == selectValue) { option.selected = true } select.appendChild(option) } var evtChange = function (e) { var eObj = $E(e); var tarCode = eObj.value; var strUrl = ""; switch (module) { case "jjpj": strUrl = "jjpj_" + tarCode + ".html"; break; case "jbgk": strUrl = "jbgk_" + tarCode + ".html"; break; case "jndzf": strUrl = "jndzf_" + tarCode + ".html"; break; case "zcpz": strUrl = "zcpz_" + tarCode + ".html"; break; case "zcfzb": strUrl = "zcfzb_" + tarCode + ".html"; break; case "jbgk": strUrl = "jbgk_" + tarCode + ".html"; break; case "ccmx1": strUrl = "ccmx1_" + tarCode + ".html"; break; case "fyfx": strUrl = "fyfx_" + tarCode + ".html"; break; case "fhsp": strUrl = "fhsp_" + tarCode + ".html"; break; case "cwzb": strUrl = "cwzb_" + tarCode + ".html"; break; case "jjjl": strUrl = "jjjl_" + tarCode + ".html"; break; case "jjgg": strUrl = "jjgg_" + tarCode + ".html"; break; case "jjfl": strUrl = "jjfl_" + tarCode + ".html"; break; case "dxjg": strUrl = "dxjg_" + tarCode + ".html"; break; case "cyrjg": strUrl = "cyrjg_" + tarCode + ".html"; break; case "srfx": strUrl = "srfx_" + tarCode + ".html"; break; case "hytz": strUrl = "hytz_" + tarCode + ".html"; break; case "hybd": strUrl = "hybd_" + tarCode + ".html"; break; case "ccbd": strUrl = "ccbd_" + tarCode + ".html"; break; case "jzbd": strUrl = "jzbd_" + tarCode + ".html"; break; case "jjjz": strUrl = "jjjz_" + tarCode + ".html"; break; case "jdzf": strUrl = "jdzf_" + tarCode + ".html"; break; case "lrfpb": strUrl = "lrfpb_" + tarCode + ".html"; break; case "gmbd": strUrl = "gmbd_" + tarCode + ".html"; break; case "ccmx": strUrl = "ccmx_" + tarCode + ".html"; break; case "ccbdxq": strUrl = "ccbdxq_" + tarCode + ".html"; break; case "sdcyr": strUrl = "sdcyr_" + tarCode + ".html"; break; case "jjzh": strUrl = "jjzh_" + tarCode + ".html"; break; case "hypzsy": strUrl = "hypzsy_" + tarCode + ".html"; break; case "tssj": strUrl = "tsdata_" + tarCode + ".html"; break; case "ccbdzs": strUrl = "ccbdzs_" + tarCode + ".html"; break; default: strUrl = "jbgk_" + tarCode + ".html"; break }location.href = strUrl }; $aE(select, "change", evtChange, true) } } var fundcodelist = { sel: "fcodelb", opt: "fundul", tagname: "li", txtObj: null, selObj: null, optObj: null, opts: null, load: function () { this.txtObj = $(this.sel); this.selObj = this.txtObj; this.optObj = $(this.opt); var $this = this; if (this.opts == null) { if (r && r.length > 0) { for (var i = 0; i < r.length; i++) { var option = $C("li"); var item = r[i].toString().split(","); option.setAttribute("fundcode", item[0]); option.innerHTML = item[0] + " - " + item[2]; option.onmouseover = function () { this.className = "over" }; option.onmouseout = function () { this.className = "" }; option.onclick = function () { $this.txtObj.innerHTML = this.innerHTML; $this.txtObj.fundcode = this.getAttribute("fundcode"); var tarCode = $this.txtObj.fundcode; switch (module) { case "jjpj": strUrl = "jjpj_" + tarCode + ".html"; break; case "jbgk": strUrl = "jbgk_" + tarCode + ".html"; break; case "jndzf": strUrl = "jndzf_" + tarCode + ".html"; break; case "zcpz": strUrl = "zcpz_" + tarCode + ".html"; break; case "zcfzb": strUrl = "zcfzb_" + tarCode + ".html"; break; case "jbgk": strUrl = "jbgk_" + tarCode + ".html"; break; case "ccmx1": strUrl = "ccmx1_" + tarCode + ".html"; break; case "fyfx": strUrl = "fyfx_" + tarCode + ".html"; break; case "fhsp": strUrl = "fhsp_" + tarCode + ".html"; break; case "cwzb": strUrl = "cwzb_" + tarCode + ".html"; break; case "jjjl": strUrl = "jjjl_" + tarCode + ".html"; break; case "jjgg": strUrl = "jjgg_" + tarCode + ".html"; break; case "jjfl": strUrl = "jjfl_" + tarCode + ".html"; break; case "dxjg": strUrl = "dxjg_" + tarCode + ".html"; break; case "cyrjg": strUrl = "cyrjg_" + tarCode + ".html"; break; case "srfx": strUrl = "srfx_" + tarCode + ".html"; break; case "hytz": strUrl = "hytz_" + tarCode + ".html"; break; case "hybd": strUrl = "hybd_" + tarCode + ".html"; break; case "ccbd": strUrl = "ccbd_" + tarCode + ".html"; break; case "jzbd": strUrl = "jzbd_" + tarCode + ".html"; break; case "jjjz": strUrl = "jjjz_" + tarCode + ".html"; break; case "jdzf": strUrl = "jdzf_" + tarCode + ".html"; break; case "lrfpb": strUrl = "lrfpb_" + tarCode + ".html"; break; case "gmbd": strUrl = "gmbd_" + tarCode + ".html"; break; case "ccmx": strUrl = "ccmx_" + tarCode + ".html"; break; case "ccbdxq": strUrl = "ccbdxq_" + tarCode + ".html"; break; case "sdcyr": strUrl = "sdcyr_" + tarCode + ".html"; break; case "jjzh": strUrl = "jjzh_" + tarCode + ".html"; break; case "hypzsy": strUrl = "hypzsy_" + tarCode + ".html"; break; default: strUrl = "jbgk_" + tarCode + ".html"; break }location.href = strUrl }; $this.optObj.appendChild(option) } } } this.selObj.onclick = function (e) { stopBubble(e); if ($this.optObj.style.display == "") { $this.optObj.style.display = "none"; $dE(document, "click", null, false) } else { $this.optObj.style.display = ""; $aE(document, "click", function () { $this.optObj.style.display = "none" }, false) } } } }; function stopBubble(e) { if (e && e.stopPropagation) { e.stopPropagation() } else { window.event.cancelBubble = true } } function LoadTimeSelect(selObj, P, callback) { var select = $(selObj); if (select.childNodes.length == 0) { var endYear = new Date().getFullYear(); if (P.years && P.years.length > 0) { for (var i = 0; i < P.years.length; i++) { var option = $C("option"); option.value = P.years[i]; option.innerHTML = P.years[i] + "年"; select.appendChild(option) } var evtChange = function (e) { var eObj = $E(e); var tarYear = eObj.value; P.year = tarYear; if (callback) { callback(P) } }; $aE(select, "change", evtChange, true) } else { var option = $C("option"); option.value = "0"; option.innerHTML = "请选择年度"; select.appendChild(option) } } else { return false } } function LoadHyinfo(pObj, pagetype) { $("hyxxtable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var strhydm = pObj.hydm; var request = "F10DataApi.aspx?pt=" + pagetype + "&type=hyxq&code=" + strcode + "&hydm=" + strhydm + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apixqdata) { if (apixqdata.content != "") { $("hyxxtable").innerHTML = apixqdata.content; $("jd").innerHTML = apixqdata.quarter; $("hypng").src = "//j6.dfcfw.com/charts/HyChangeArchives" + pagetype + "/" + strcode + "_" + strhydm + "_" + pagetype + ".png"; $("infourl").href = "hybd_" + strcode + "_" + strhydm + "_" + pagetype + ".html" } else { $("hyxxtable").innerHTML = ""; $("jd").innerHTML = ""; $("hypng").src = "//j6.dfcfw.com/charts/999999_Archives.png" } ChkSelectItem("hy", strhydm) } }) } function LoadHySelect(strcode, pObj, callback, pagetype) { var request = "F10DataApi.aspx?pt=" + pagetype + "&type=hylx&code=" + strcode + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apilxdata && apilxdata.hylx) { if (pObj.hydm == "") { pObj.hydm = apilxdata.hylx[0][0]; document.getElementById("hy").src = "//j6.dfcfw.com/charts/HyChangeArchives" + pagetype + "/" + pObj.code + "_" + pObj.hydm + "_" + pagetype + ".png" } for (var i = 0; i < apilxdata.hylx.length; i++) { var option = $C("option"); option.value = apilxdata.hylx[i][0]; option.innerHTML = apilxdata.hylx[i][1]; $("hy").appendChild(option) } var evtChange = function (e) { var eObj = $E(e); var tardm = eObj.value; pObj.hydm = tardm; if (callback) { callback(pObj, pagetype) } }; $aE($("hy"), "change", evtChange, true) } }) } function LoadStockPos(pObj) { $("cctable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var syear = pObj.year; var topline = pObj.topnum; var smonth = pObj.month; var request = "FundArchivesDatas.aspx?type=jjcc&code=" + strcode + "&topline=" + topline + "&year=" + syear + "&month=" + smonth + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata.content && apidata.content != "") { $("ccpng").src = "//j6.dfcfw.com/charts/StockPos/" + strcode + ".png?rt=" + Math.round(); $("cctable").innerHTML = apidata.content; $("pagebar").innerHTML = makePageBarForYear(apidata.arryear, apidata.curyear) } else { $("jjcc_tab").style.display = ""; $dC($("boxh4"), "nb"); $("ccpng").src = "//j6.dfcfw.com/charts/999999_Archives.png"; $("cctable").innerHTML = ""; $("pagebar").innerHTML = "" } CalPagePosition(); pObj.years = apidata.arryear; EventForYearBtn(pObj, LoadStockPos); LoadTimeSelect("jjcc", pObj, LoadStockPos); setTimeout(function () { ChkSelectItem("jjcc", syear) }, 200); if (document.getElementById("gpdmList") != null) { LoadGpzd(document.getElementById("gpdmList").innerHTML) } }) } function LoadGpzd(gpdmCode) { if (gpdmCode != "") { var codeArr = gpdmCode.split(","); var size = 120; var num = Math.ceil(codeArr.length / size); var codeArrGrouped = []; var startIndex = 0; var codeArrSlice = []; var strCode = ""; for (var i = 0; i < num; i++) { startIndex = i * size; endIndex = startIndex + size; codeArrSlice = codeArr.slice(startIndex, endIndex); strCode = codeArrSlice.join(","); codeArrGrouped.push(strCode) } if (codeArrGrouped.length > 0) { GpzdData(codeArrGrouped, 0) } } } function GpzdData(codeArr, codeArrIndex) { var strCode = codeArr[codeArrIndex]; var apiurl = "https://push2.eastmoney.com/api/qt/ulist.np/get?fltt=2&invt=2&fields=f2,f3,f12,f14,f9&cb=?&ut=267f9ad526dbe6b0262ab19316f5a25b&secids=" + strCode; jQuery.getJSON(apiurl, function (res) { var ccolor = new Array(); var cclist = new Array(); var zxjArr = new Array(); var zxjcolorarr = new Array(); var favlist = []; if (res == null || res.data == null || res.data.diff == null) { return } favlist = res.data.diff; for (var i = 0; i < favlist.length; i++) { if (favlist[i] != null) { var tempfavlist = favlist[i]; var zxjObjs = jQuery("[data-id='" + "dq" + tempfavlist.f12 + "']"); var zdfObjs = jQuery("[data-id='" + "zd" + tempfavlist.f12 + "']"); if (!!zxjObjs && zxjObjs.length > 0) { for (var index = 0; index < zxjObjs.length; index++) { var zxj = zxjObjs[index]; var zdf = zdfObjs[index]; zxj.innerHTML = tempfavlist.f2 == "-" ? "-" : tempfavlist.f2.toFixed(2); zdf.innerHTML = tempfavlist.f3 == "-" ? "-" : tempfavlist.f3.toFixed(2) + "%"; cclist.push(zdf); zxjArr.push(zxj); var zdfd = zdf.innerHTML.replace("%", ""); if (zdfd.indexOf("-") != 0) { try { zdfd = parseFloat(zdfd); if (zdfd == 0 || zdfd == 0 || isNaN(zdfd)) { ccolor.push("ping"); window.jQuery(zxj).attr("class", "ping") } else { ccolor.push("zhang"); window.jQuery(zxj).attr("class", "zhang") } } catch (ex) { ccolor.push("ping"); window.jQuery(zxj).attr("class", "ping") } } else { ccolor.push("die"); window.jQuery(zxj).attr("class", "die") } zxjcolorarr.push(window.jQuery(zxj).attr("class")) } } } } setFlash2(cclist, "", ccolor); setFlash2(zxjArr, "ping", zxjcolorarr) }); codeArrIndex++; if (codeArr.length > codeArrIndex) { setTimeout(function () { GpzdData(codeArr, codeArrIndex) }, 240) } } function setClass2(obj, cname) { if (typeof obj == "object") { for (var i = 0; i < obj.length; i++) { if (cname != "" && cname.length > 0) { obj[i].className = "zf" + " " + cname[i] } else { obj[i].className = "zf ping" } } } } function setFlash2(obj, cls1, cls2) { var setFout2 = null; setTimeout(function () { setClass2(obj, cls1) }, 600); setTimeout(function () { setClass2(obj, cls2) }, 900); if (setFout2 != null) { clearTimeout(setFout2) } } function LoadStockHis(pObj) { $("cctable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var strgpdm = pObj.gpdm; if (strgpdm != "") { document.getElementById("ggpic").src = "//j6.dfcfw.com/charts/StockOneArchives/" + pObj.code + "_" + pObj.gpdm + ".png" } var request = "F10DataApi.aspx?type=ggxq&code=" + strcode + "&gpdm=" + strgpdm + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata.content) { $("cctable").innerHTML = apidata.content; $("jd").innerHTML = "（" + apidata.quarter + "）" } }) } function LoadStockList(strcode, pObj, callback) { var request = "F10DataApi.aspx?type=gglx&code=" + strcode + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata && apidata.gplx) { if (pObj.gpdm == "") { pObj.gpdm = apidata.gplx[0][0]; $("ggpic").src = "//j6.dfcfw.com/charts/StockOneArchives/" + pObj.code + "_" + pObj.gpdm + ".png" } for (var i = 0; i < apidata.gplx.length; i++) { var option = $C("option"); option.value = apidata.gplx[i][0]; option.innerHTML = apidata.gplx[i][1]; $("gg").appendChild(option) } var evtChange = function (e) { var eObj = $E(e); var tardm = eObj.value; pObj.gpdm = tardm; location.href = "ccbdxq_" + pObj.code + "_" + pObj.gpdm + ".html" }; $aE($("gg"), "change", evtChange, true); ChkSelectItem("gg", pObj.gpdm) } else { var option = $C("option"); option.value = "0"; option.innerHTML = "请选择"; $("gg").appendChild(option) } }) } function LoadBond(pObj) { $("cctable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var syear = pObj.year; var request = "FundArchivesDatas.aspx?type=zqcc&code=" + strcode + "&year=" + syear + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata.content && apidata.content != "") { $("cctable").innerHTML = apidata.content; $("pagebar").innerHTML = makePageBarForYear(apidata.arryear, apidata.curyear) } else { $("zqpng").src = "//j6.dfcfw.com/charts/999999_Archives.png?rt=" + Math.round(); $("cctable").innerHTML = ""; $("pagebar").innerHTML = "" } CalPagePosition(); pObj.years = apidata.arryear; LoadTimeSelect("zqcc", pObj, LoadBond); ChkSelectItem("zqcc", syear); EventForYearBtn(pObj, LoadBond) }) } function LoadMajor(pObj) { $("bdtable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var strinout = pObj.type; var syear = pObj.year; var request = "FundArchivesDatas.aspx?type=zdbd&code=" + strcode + "&zdbd=" + (parseInt(strinout) + 1).toString() + "&year=" + syear + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata.content && apidata.content != "") { $("bdtable").innerHTML = apidata.content; $("pagebar").innerHTML = makePageBarForYear(apidata.arryear, apidata.curyear) } else { $("bdtable").innerHTML = "<label class='tbnull'>暂无数据!</label>"; $("pagebar").innerHTML = "" } CalPagePosition(); pObj.years = apidata.arryear; LoadTimeSelect("zdbdSel", pObj, LoadMajor); ChkSelectItem("zdbdSel", syear); EventForYearBtn(pObj, LoadMajor) }) } function LoadBalance(pObj) { $("cwtable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var strinout = pObj.type; var syear = pObj.year; var request = "FundArchivesDatas.aspx?type=zcfzb&code=" + strcode + "&showtype=" + (parseInt(strinout) + 1).toString() + "&year=" + syear + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata.content && apidata.content != "") { $("cwtable").innerHTML = apidata.content; $("pagebar").innerHTML = makePageBarForYear(apidata.arryear, apidata.curyear) } else { $("cwtable").innerHTML = "<label class='tbnull'>暂无数据!</label>"; $("pagebar").innerHTML = "" } CalPagePosition(); pObj.years = apidata.arryear; EventForYearBtn(pObj, LoadBalance) }) } function LoadFinancial(pObj) { $("cwtable").innerHTML = _loadingHtml; var strcode = pObj.code; var type = pObj.type; var syear = pObj.year; var request = apiHost + "/f10/GetArrayCwzb?fundcode=" + strcode + "&showtype=" + type + "&year=" + syear + "&callback=?"; jQuery.getJSON(request, function (ret) { if (ret.ErrCode == 0) { var html = template("cwtableTmpl", ret.Data.data); document.getElementById("cwtable").innerHTML = html; $("pagebar").innerHTML = makePageBarForYear(ret.Data.years, ret.Data.year); CalPagePosition(); pObj.years = ret.Data.years; EventForYearBtn(pObj, LoadFinancial) } else { document.getElementById("cwtable").innerHTML = "<label class='tbnull'>暂无数据!</label>" } }) } function LoadProfit(pObj) { $("cwtable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var strinout = pObj.type; var syear = pObj.year; var request = "FundArchivesDatas.aspx?type=lrfpb&code=" + strcode + "&showtype=" + (parseInt(strinout) + 1).toString() + "&year=" + syear + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata.content && apidata.content != "") { $("cwtable").innerHTML = apidata.content; $("pagebar").innerHTML = makePageBarForYear(apidata.arryear, apidata.curyear) } else { $("cwtable").innerHTML = "<label class='tbnull'>暂无数据</label>"; $("pagebar").innerHTML = "" } CalPagePosition(); pObj.years = apidata.arryear; EventForYearBtn(pObj, LoadProfit) }) } function LoadCyrjg(pObj) { $("cyrjgtable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var request = "FundArchivesDatas.aspx?type=cyrjg&code=" + strcode + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata.content && apidata.content != "") { $("cyrjgpng").src = "//j6.dfcfw.com/charts/Cyrjg/" + strcode + ".png"; $("cyrjgtable").innerHTML = apidata.content; $("summary").innerHTML = apidata.summary } else { $("cyrjgtable").innerHTML = "<label class='tbnull'>暂无数据!</label>"; $("cyrjgpng").src = "//j6.dfcfw.com/charts/999999_Archives.png" } }) } function loadLSYZSY(strcode) { $("lsyzqsy").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var request = "FundArchivesDatas.aspx?type=yzlssy&code=" + strcode + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (yzlssydata.content && yzlssydata.content != "") { $("lsyzqsy").innerHTML = yzlssydata.content } else { $("lsyzqsy").innerHTML = "<label class='tbnull'>暂无数据!</label>" } }) } function LoadHypzsy(pObj) { $("hypzsytable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var request = "FundArchivesDatas.aspx?type=hypzsy&code=" + strcode + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata.content && apidata.content != "") { $("hypzsytable").innerHTML = apidata.content; $("summary").innerHTML = apidata.summary } else { $("hypzsytable").innerHTML = "<label class='tbnull'>暂无数据!</label>" } }) } function LoadJdndzf(pObj) { $("jdndzftable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var request = "FundArchivesDatas.aspx?type=jdndzf&code=" + strcode + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata.content && apidata.content != "") { $("jdndzfpng").src = "//j6.dfcfw.com/charts/QuarterGain/" + strcode + ".png"; $("jdndzftable").innerHTML = apidata.content; $("summary").innerHTML = apidata.summary } else { $("jdndzftable").innerHTML = "<label class='tbnull'>暂无数据!</label>"; $("jdndzfpng").src = "//j6.dfcfw.com/charts/999999_Archives.png" } }) } function LoadYearZF(pObj) { $("yearzftable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var request = "FundArchivesDatas.aspx?type=yearzf&code=" + strcode + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (yapidata.content && yapidata.content != "") { $("yearzftable").innerHTML = yapidata.content; infoTips() } else { $("yearzftable").innerHTML = "<label class='tbnull'>暂无数据!</label>" } }) } function LoadQuarterZF(pObj) { $("quarterzftable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var request = "FundArchivesDatas.aspx?type=quarterzf&code=" + strcode + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (qapidata.content && qapidata.content != "") { $("quarterzftable").innerHTML = qapidata.content; infoTips() } else { $("quarterzftable").innerHTML = "<label class='tbnull'>暂无数据!</label>" } }) } function LoadJdzf(pObj) { $("jdzftable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var request = "FundArchivesDatas.aspx?type=jdzf&code=" + strcode + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (apidata.content && apidata.content != "") { $("jdzftable").innerHTML = apidata.content; infoTips() } else { $("jdzftable").innerHTML = "<label class='tbnull'>暂无数据!</label>" } }) } function LoadGmbd(pObj) { $("gmbdtable").innerHTML = "<div style='text-align:center; font-size:14px;'><img src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' style='margin:50px 10px; vertical-align:middle;' />数据加载中...</div>"; var strcode = pObj.code; var request = "FundArchivesDatas.aspx?type=gmbd&mode=" + pObj.type + "&code=" + strcode + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { if (gmbd_apidata.content && gmbd_apidata.content != "") { $("summary").innerHTML = gmbd_apidata.summary; $("gmbdtable").innerHTML = gmbd_apidata.content } else { $("gmbdtable").innerHTML = "<label class='tbnull'>暂无数据!</label>" } }) } function loadJzcgmChart(pObj) { var strcode = pObj.code; var request = "FundArchivesDatas.aspx?type=jzcgm&code=" + strcode + "&rt=" + Math.random(); var charid = "#fejzcChart"; if (isLtIE9()) { var tips = getChartTips(); $(charid).html(tips) } JsLoader(request, "utf-8", function () { jQuery(charid + " .loading").remove(); fejzcChart(charid, jzcgm_apidata) }) } function _fejzcValueFormat(val) { var ret = 0; if (!isNaN(val)) { ret = parseFloat(val) / 100000000; ret = Math.round(ret * 100) / 100 } return ret } function GmbdBind(clickList, pObj) { for (i = 0; i < clickList.length; i++) { $(clickList[i]).onclick = function () { if (this.className.indexOf("at") < 0) { var index = this.id.split("_")[1]; pObj.type = index; ScaleTypeSelect(index); LoadGmbd(pObj) } } } } function ScaleTypeSelect(index) { if (index == "0") { $aC($("scalepicleft_0"), "at"); $dC($("scalepicright_1"), "at"); $aC($("scaleconleft_0"), "at"); $dC($("scaleconright_1"), "at") } else { $dC($("scalepicleft_0"), "at"); $aC($("scalepicright_1"), "at"); $dC($("scaleconleft_0"), "at"); $aC($("scaleconright_1"), "at") } } function CalOffsetHeight(obj) { var maxhh, minhh; maxhh = minhh = $(obj).getElementsByTagName("dt")[0].offsetHeight - 1; var dds = $(obj).getElementsByTagName("dd"); for (var i = 0; i < dds.length; i++) { if (dds[i].className.indexOf("at") > -1) { maxhh += 30 } else { if (dds[i].className.indexOf("nb") > -1) { maxhh += 25 } else { maxhh += 28 } } } return { min: minhh, max: maxhh + 2 } } function ClickPuckerEvent(obj) { var dlObj = $(obj).parentNode; var min = CalOffsetHeight(dlObj).min; var max = CalOffsetHeight(dlObj).max; var hhh = $(dlObj).offsetHeight; var timer, s = 10, delay = 20, t = 0; var pucker = function () { t += 2; hhh = $(dlObj).offsetHeight; if (hhh > min) { if ((hhh - s * t) < min) { dlObj.style.height = min + "px" } else { dlObj.style.height = (hhh - s * t) + "px" } if (timer != null) { clearInterval(timer); t = 0 } timer = setInterval(pucker, delay) } else { clearInterval(timer); t = 0 } }; var pinch = function () { t += 2; hhh = $(dlObj).offsetHeight; if (hhh < max) { if ((hhh + s * t) > max) { dlObj.style.height = max + "px" } else { dlObj.style.height = (hhh + s * t) + "px" } if (timer != null) { clearInterval(timer); t = 0 } timer = setInterval(pinch, delay) } else { clearInterval(timer); t = 0 } }; if (hhh > min) { pucker(); $(obj).getElementsByTagName("b")[0].className = "ico pucker" } else { pinch(); $(obj).getElementsByTagName("b")[0].className = "ico pinch" } } function setClass(obj, cname) { if (typeof obj == "object") { for (var i = 0; i < obj.length; i++) { if (obj[i].className.indexOf("red") == 0) { obj[i].className = obj[i].className.toString().replace("red", cname) } if (obj[i].className.indexOf("grn") == 0) { obj[i].className = obj[i].className.toString().replace("grn", cname) } if (obj[i].className.indexOf("bck") == 0) { obj[i].className = obj[i].className.toString().replace("bck", cname) } } } } function setFlash(obj, cls1, cls2) { setTimeout(function () { setClass(obj, cls1) }, 600); setTimeout(function () { setClass(obj, cls2) }, 900); setTimeout(function () { setClass(obj, cls1) }, 1200); setTimeout(function () { setClass(obj, cls2) }, 1500) } function reGetGZ(code) { try { var request = apiHost + "/fund/fundgz?callback=?&fundcode=" + code; var gsz_span = document.getElementById("fund_gsz"); var gszf_span = document.getElementById("fund_gszf"); var gsz_icon = document.getElementById("fundgz_icon"); if (gsz_span && gszf_span && gsz_icon) { jQuery.getJSON(request, function (ret) { try { var arrObj = new Array(); var oldval = gsz_span.innerHTML; if (ret && ret.Data && ret.ErrCode == 0 && ret.Data.length > 0 && ret.Data[0].dwjz != "") { var fundgzinfo = ret.Data[0]; gsz_span.innerHTML = parseFloat(fundgzinfo.gsz).toFixed(4); gszf_span.innerHTML = (parseFloat(fundgzinfo.gszzl)).toFixed(2) + "%"; gsz_span.className = fundgzinfo.gszzl > 0 ? "red lar bold guzhi" : fundgzinfo.gszzl < 0 ? "grn lar bold guzhi" : "blk lar bold guzhi"; gszf_span.className = fundgzinfo.gszzl > 0 ? "red lar bold" : fundgzinfo.gszzl < 0 ? "grn lar bold " : "blk lar bold "; gsz_icon.className = fundgzinfo.gszzl > 0 ? "icon  icon-up" : fundgzinfo.gszzl < 0 ? "icon  icon-down" : "icon"; arrObj.push(gsz_span); arrObj.push(gszf_span); setFlash(arrObj, "bck", (fundgzinfo.gszzl > 0 ? "red" : fundgzinfo.gszzl < 0 ? "grn" : "bck")) } else { gsz_span.innerHTML = "---"; gszf_span.innerHTML = "---"; gsz_span.className = ""; gszf_span.className = ""; arrObj.push(gsz_span); arrObj.push(gszf_span); setFlash(arrObj, "bck", "bck") } } catch (ex) { } }) } } catch (e) { } } function dtClickEvent() { try { var dts = $("dlcontent").getElementsByTagName("dt"); var _click = function (e) { var eObj = $E(e); if (eObj.tagName == "DT" || eObj.parentNode.tagName == "DT") { if (eObj.tagName != "DT") { eObj = eObj.parentNode } ClickPuckerEvent(eObj) } else { return false } }; for (var i = 0; i < dts.length; i++) { $aE(dts[i], "click", _click, true) } } catch (e) { } } function loadFundGrade(pObj) { var requestUrl = apiHost + "/F10/JJPJ/?callback=?&fundcode=" + pObj.code + "&pageIndex=" + pObj.pindex + "&pageSize=" + pObj.pernum; try { if (jQuery) { jQuery.getJSON(requestUrl, function (data) { if (data && data.ErrCode == 0 && data.Data && data.Data.length > 0) { fundGradeList = new Array(); for (var i in data.Data) { var oneRow = data.Data[i]; fundGradeList.push(new Grade(oneRow.RDATE, oneRow.HTPJ, oneRow.ZSPJ, oneRow.SZPJ3, oneRow.ZSPJ5, oneRow.JAPJ, oneRow.CXPJ3)) } showFundGrdeToPage(fundGradeList); var totalPages = Math.ceil(data.TotalCount / data.PageSize); $("pagebar").innerHTML = makePageBar(data.TotalCount, totalPages, data.PageIndex); pObj.pages = totalPages; EventForPageBtn(pObj, loadFundGrade) } else { var tbObj = $("fundgradetable"); if (tbObj.tBodies[0]) { tbObj.removeChild(tbObj.tBodies[0]) } var tBody = document.createElement("tBody"); var _tr = document.createElement("tr"); var _td = document.createElement("td"); _td.colSpan = 8; _td.innerHTML = "<label class='tbnull'>暂无基金评级</label>"; _tr.appendChild(_td); tBody.appendChild(_tr); tbObj.appendChild(tBody) } }) } } catch (e) { var tbObj = $("fundgradetable"); if (tbObj.tBodies[0]) { tbObj.removeChild(tbObj.tBodies[0]) } var tBody = document.createElement("tBody"); var _tr = document.createElement("tr"); var _td = document.createElement("td"); _td.colSpan = 8; _td.innerHTML = "<label class='tbnull'>暂无基金评级！</label>"; _tr.appendChild(_td); tBody.appendChild(_tr); tbObj.appendChild(tBody) } } function FormatNumberToStar(starNum) { var starHtml = ""; var stars = parseInt(starNum, 10); if (!isNaN(stars)) { for (var i = 0; i < stars; i++) { starHtml += "★" } } else { var starHtml = "--" } return starHtml } function toThousands(num) { if (num) { num = num.toFixed(2) } return (num + "").replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g, "$&,") } function sortGradeTable() { fundGradeList.reverse(); showFundGrdeToPage() } function showFundGrdeToPage(fundGradeList) { var frag = document.createDocumentFragment(); for (var i in fundGradeList) { var _tr = document.createElement("tr"); var _td = document.createElement("td"); _td.innerHTML = fundGradeList[i].date; _tr.appendChild(_td); _td = document.createElement("td"); _td.innerHTML = FormatNumberToStar(fundGradeList[i].zs); _tr.appendChild(_td); _td = document.createElement("td"); _td.innerHTML = FormatNumberToStar(fundGradeList[i].shThree); _tr.appendChild(_td); _td = document.createElement("td"); _td.innerHTML = FormatNumberToStar(fundGradeList[i].shFive); _tr.appendChild(_td); _td = document.createElement("td"); _td.innerHTML = FormatNumberToStar(fundGradeList[i].jaj); _tr.appendChild(_td); _td = document.createElement("td"); _td.innerHTML = FormatNumberToStar(fundGradeList[i].cxj); _tr.appendChild(_td); frag.appendChild(_tr) } var tbObj = $("fundgradetable"); if (tbObj.tBodies[0]) { tbObj.removeChild(tbObj.tBodies[0]) } var tBody = document.createElement("tBody"); tBody.appendChild(frag); tbObj.appendChild(tBody) } function Grade(date, ht, zs, shThree, shFive, jaj, cxj) { this.date = date; this.ht = ht; this.zs = zs; this.shThree = shThree; this.shFive = shFive; this.jaj = jaj; this.cxj = cxj } var isrenderFundHoldChange = false; function loadFundHoldChange(pObj) { var requestUrl = apiHost + "/f10/FundGPTop10/?callback=?&fundcode=" + pObj.code + "&pageindex=" + pObj.pindex + "&pagesize=" + pObj.pernum; jQuery.getJSON(requestUrl, function (jsondata) { if (jsondata && jsondata.ErrCode == 0 && jsondata.Data) { var data = jsondata.Data; var chartData = { x: [], y: [] }; if (data != null && data.length > 0) { var arr = []; arr.push('<div class="space8"></div><table class="w782 comm cgbd">'); arr.push("<thead><tr><th>报告期</th><th>持仓集中度（占净值比）</th></tr></thead><tbody>"); for (var i = 0, len = data.length; i < len; i++) { if (i < 5) { chartData.x.push(data[i]["REPORTDATE"]); chartData.y.push(data[i]["FSTOCKCENTER"]) } arr.push("<tr><td >", data[i]["REPORTDATE"], "</td><td class='tor'>", !isNaN(data[i]["FSTOCKCENTER"]) ? data[i]["FSTOCKCENTER"].toFixed(2) + "%" : "--", "</td></tr>") } arr.push("</tbody></table>"); jQuery("#qscctable").html(arr.join("")); jQuery("#pagebar").html(makePageBar(jsondata.TotalCount, Math.ceil(jsondata.TotalCount / jsondata.PageSize), jsondata.PageIndex)); CalPagePosition(); pObj.pages = Math.ceil(jsondata.TotalCount / jsondata.PageSize); EventForPageBtn(pObj, loadFundHoldChange); if (!!chartData && !!chartData.x && chartData.x.length > 0 && !isrenderFundHoldChange) { jQuery("#container .loading").remove(); chartData.x.reverse(); chartData.y.reverse(); holdChangeChart("#container", chartData); isrenderFundHoldChange = true } } else { jQuery("#qscctable").html("<label class='tbnull'>暂无数据!</label>"); jQuery("#container .loading").remove(); holdChangeChart("#container", chartData) } } else { jQuery("#container .loading").remove(); jQuery("#qscctable").html("<label class='tbnull'>暂无数据!</label>") } }) } var isRenderFundTurnover = false; function loadFundTurnover(pObj) { var request = apiHost + "/f10/JJHSL/?callback=?&fundcode=" + pObj.code + "&pageindex=" + pObj.pindex + "&pagesize=" + pObj.pernum; jQuery.getJSON(request, function (jsondata) { if (jsondata && jsondata.ErrCode == 0 && jsondata.Data) { var data = jsondata.Data; var chartData = { x: [], y: [] }; if (data != null && data.length > 0) { var arr = []; arr.push('<div class="space8"></div><table class="w782 comm  cgbd">'); arr.push("<thead><tr><th>报告期</th><th>基金换手率</th></tr></thead><tbody>"); for (var i = 0, len = data.length; i < len; i++) { if (i < 5) { chartData.x.push(data[i]["REPORTDATE"]); chartData.y.push(data[i]["STOCKTURNOVER"]) } arr.push("<tr><td>", data[i]["REPORTDATE"], "</td><td class='tor'>", !isNaN(data[i]["STOCKTURNOVER"]) ? data[i]["STOCKTURNOVER"].toFixed(2) + "%" : "--", "</td></tr>") } arr.push("</tbody></table>"); jQuery("#hsltable").html(arr.join("")); jQuery("#hslpager").html(makePageBar(jsondata.TotalCount, Math.ceil(jsondata.TotalCount / jsondata.PageSize), jsondata.PageIndex)); CalPagePosition("hslpager"); pObj.pages = Math.ceil(jsondata.TotalCount / jsondata.PageSize); EventForPageBtn(pObj, loadFundTurnover, "hslpager"); if (!!chartData && !!chartData.x && chartData.x.length > 0 && !isRenderFundTurnover) { jQuery("#chartTurnover .loading").remove(); chartData.x.reverse(); chartData.y.reverse(); turnoverChart("#chartTurnover", chartData); isRenderFundTurnover = true } } else { jQuery("#hsltable").html("<label class='tbnull'>暂无数据!</label>"); jQuery("#chartTurnover .loading").remove(); turnoverChart("#chartTurnover", chartData) } } else { jQuery("#chartTurnover .loading").remove(); jQuery("#hsltable").html("<label class='tbnull'>暂无数据!</label>") } }) } function loadHysyl(pObj) { $("sylChart").innerHTML = "<div class='loading' ><img class='img' src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中'  />数据加载中...</div>"; var requestUrl = "F10DataApi.aspx?type=hysyl&indcode=" + pObj.indcode + "&Y=" + pObj.Y + "&Q=" + pObj.Q + "&lastestYear=1&rt=" + Math.random(); JsLoader(requestUrl, "utf-8", function () { $("sylChart").innerHTML = ""; apidata.title = pObj.title; hysylChart("#sylChart", apidata) }) } function LoadFqzj(pObj) { if ($("fqzjtable") == null) { return } var strcode = pObj.code; var request = "F10DataApi.aspx?type=nbzjcy&date=&code=" + pObj.code + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { var data = apidata_fqzj.Data; if (data.length > 0) { var arr = []; arr.push('<table class="w782 comm cyrjg"><thead><tr><th>时间</th><th>持有份额总数(份)</th><th class="fqzjtr">持有份额占基金总份额比例(%)</th><th>发起份额总数(份)</th><th class="fqzjtr">发起份额占基金总份额比例(%)</th><th>持有份额详情</th></tr></thead><tbody>'); for (var i = 0, len = data.length; i < len; i++) { arr.push("<tr>"); arr.push("<td >", data[i]["REPORTDATE"], (i == len - 1 ? "(初始)" : ""), "</td>"); arr.push('<td  class="tor" >', setEmptyDefault(toThousands(data[i]["TOTALHOLD"])), '</td><td class="tor">', setEmptyDefault(data[i]["HOLDRATIO"]) == "--" ? "--" : data[i]["HOLDRATIO"].toFixed(2) + "%", '</td><td class="tor">', setEmptyDefault(toThousands(data[i]["TOTALSHARE"])), '</td> <td class="tor">', setEmptyDefault(data[i]["SHARERATIO"]) == "--" ? "--" : data[i]["SHARERATIO"].toFixed(2) + "%", "</td>"); var d = NewDate(data[i]["REPORTDATE"]); var yearmonth = d.getFullYear() + "-" + (d.getMonth() + 1); arr.push('<td><a href="nbzjcyxq_', pObj.code, "_", yearmonth, '.html">查看详情</a></td></tr>') } arr.push("</tbody></table>"); $("fqzjtable").innerHTML = arr.join("") } else { $("fqzjtable").innerHTML = "<label class='tbnull'>暂无数据!</label>" } }) } function NewDate(str) { str = str.split("-"); var date = new Date(); date.setUTCFullYear(str[0], str[1] - 1, str[2]); date.setUTCHours(0, 0, 0, 0); return date } function LoadNbzjcy(pObj) { $("nbzjtable").innerHTML = "<div class='loading'><img class='img' src='//j5.dfcfw.com/j1/images/loading2.gif' title='数据加载中' />数据加载中...</div>"; var strcode = pObj.code; var d = pObj.date.replace("年", "-").replace("月", ""); var request = "F10DataApi.aspx?type=nbzjcy&date=" + d + "&code=" + pObj.code + "&rt=" + Math.random(); JsLoader(request, "utf-8", function () { var data = apidata_fqzj.Data; var maxDate = apidata_fqzj.MaxDate; $("limitDate").innerHTML = setEmptyDefault(maxDate); if (data.length > 0) { var arr = []; arr.push('<table class="w782 comm  cyrjg "><thead><tr><th>项目</th><th >持有份额总数(份)</th><th >持有份额占基金总份额比例(%)</th><th>发起份额总数(份)</th><th >发起份额占基金总份额比例(%)</th><th >发起份额承诺持有期限</th></tr></thead><tbody>'); for (var i = 0, len = data.length; i < len; i++) { arr.push("<tr>"); arr.push('<td class="tol">', _cyrType(data[i]["ITEM"]), '</td><td class="tor">', setEmptyDefault(toThousands(data[i]["TOTALHOLD"])), '</td><td class="tor">', (setEmptyDefault(data[i]["HOLDRATIO"]) == "--" ? "--" : data[i]["HOLDRATIO"].toFixed(2) + "%"), "</td> "); arr.push('<td class="tor">', setEmptyDefault(toThousands(data[i]["TOTALSHARE"])), '</td> <td class="tor">', (setEmptyDefault(data[i]["SHARERATIO"]) == "--" ? "--" : data[i]["SHARERATIO"].toFixed(2) + "%"), "<td>", data[i]["PROMISEHOLD"], "</td></tr>") } arr.push("</tbody></table>"); $("nbzjtable").innerHTML = arr.join("") } else { $("nbzjtable").innerHTML = "<label class='tbnull'>暂无数据!</label>" } }) } function setEmptyDefault(data) { if (data == null || data == "") { return "--" } else { return data } } function _getNbzjcyDateColspan(data, date) { var ret = 0; for (var i = 0, len = data.length; i < len; i++) { if (date == data[i]["REPORTDATE"]) { ret++ } else { if (ret > 0) { break } } } return ret } function _cyrType(code) { var ret = ""; switch (code) { case "01": ret = "基金管理公司固有资金"; break; case "02": ret = "基金管理公司高级管理人员"; break; case "03": ret = "基金经理等人员"; break; case "04": ret = "基金管理公司股东"; break; case "05": ret = "其他"; break; case "06": ret = "合计"; break }return ret } function infoTips() { try { jQuery(".infoTips").each(function (i, c) { window.tipsBubble = null; jQuery(this).off("mouseover"); jQuery(this).off("mouseout"); jQuery(this).on("mouseover", function () { clearInterval(tipsBubble); jQuery(".tipsBubble").hide(); jQuery(this).find(".tipsBubble").show() }); jQuery(this).on("mouseout", function () { var _this = jQuery(this); tipsBubble = setTimeout(function () { _this.find(".tipsBubble").hide() }, 300) }) }) } catch (e) { } };